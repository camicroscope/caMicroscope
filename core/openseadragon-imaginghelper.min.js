//! OpenSeadragonImagingHelper 1.2.0
//! Build date: 2017-11-07
//! Git commit: v1.2.0-6-ge1a5465
//! https://github.com/msalsbery/OpenSeadragonImagingHelper
!function(a,b,c){function d(){this._haveImage=!0;var a,b={};if(this._viewer.viewport.contentSize)a=this._viewer.viewport.contentSize;else{var c=this._viewer.world.getHomeBounds();b.x=c.width-c.x,b.y=c.height-c.y,a=this._viewer.world.getItemAt(0).viewportToImageCoordinates(b.x,b.y)}this.imgWidth=a.x,this.imgHeight=a.y,this.imgAspectRatio=this.imgWidth/this.imgHeight,this._trackZoomPan()}function e(){this._haveImage=!1,this.imgWidth=0,this.imgHeight=0,this.imgAspectRatio=0}function f(){this._trackZoomPan()}function g(){this._trackZoomPan()}function h(){this._viewer&&this._viewer.autoResize&&this._trackZoomPan()}function i(){this._trackZoomPan()}function j(){this._trackZoomPan()}a.Viewer.prototype.activateImagingHelper=function(a){return this.imagingHelper||(a=a||{},a.viewer=this,this.imagingHelper=new b.ImagingHelper(a)),this.imagingHelper},b.ImagingHelper=function(b){if(b=b||{},!b.viewer)throw new Error("A viewer must be specified.");if(b.viewer.imagingHelper)throw new Error("Viewer already has an ImagingHelper.");this._viewer=b.viewer,a.EventSource.call(this),this._viewer.imagingHelper=this,this.options=b,this.imgWidth=0,this.imgHeight=0,this.imgAspectRatio=0,this._zoomFactor=1,this._minZoom=.001,this._maxZoom=10,this._zoomStepPercent=30,this._haveImage=!1,this._viewerSize=null,this._viewportWidth=0,this._viewportHeight=0,this._viewportOrigin=new OpenSeadragon.Point(0,0),this._viewportCenter=new OpenSeadragon.Point(0,0),b.onImageViewChanged&&this.addHandler("image-view-changed",b.onImageViewChanged),this._viewer.addHandler("open",a.delegate(this,d)),this._viewer.addHandler("close",a.delegate(this,e)),this._viewer.addHandler("animation",a.delegate(this,f)),this._viewer.addHandler("animation-finish",a.delegate(this,g)),this._viewer.addHandler("resize",a.delegate(this,h)),this._viewer.addHandler("full-page",a.delegate(this,i)),this._viewer.addHandler("full-screen",a.delegate(this,j))},b.ImagingHelper.version={versionStr:"1.2.0",major:1,minor:2,revision:0},a.extend(b.ImagingHelper.prototype,a.EventSource.prototype,{_raiseImageViewChanged:function(){this.raiseEvent("image-view-changed",{viewportWidth:this._viewportWidth,viewportHeight:this._viewportHeight,viewportOrigin:this._viewportOrigin,viewportCenter:this._viewportCenter,zoomFactor:this._zoomFactor})},_trackZoomPan:function(){var a=this._viewer.viewport.getBounds(!0);this._viewportOrigin.x=a.x,this._viewportOrigin.y=a.y*this.imgAspectRatio,this._viewportWidth=a.width,this._viewportHeight=a.height*this.imgAspectRatio,this._viewportCenter.x=this._viewportOrigin.x+this._viewportWidth/2,this._viewportCenter.y=this._viewportOrigin.y+this._viewportHeight/2,this._zoomFactor=this.getViewerContainerSize().x/(this._viewportWidth*this.imgWidth),this._raiseImageViewChanged()},getViewerContainerSize:function(){var b=this._viewer.container;return new a.Point(b.clientWidth,b.clientHeight)},notifyResize:function(){var a,b,c;this._haveImage&&(a=this.getViewerContainerSize(),a.equals(this._viewerSize)||(this._viewerSize=a,b=new OpenSeadragon.Point(this._viewportCenter.x,this._viewportCenter.y/this.imgAspectRatio),c=this._zoomFactor,this._viewer.viewport.resize(a,!1),this._viewer.viewport.zoomTo(c*this.imgWidth/a.x,null,!0),this._viewer.viewport.panTo(b,!0),this._raiseImageViewChanged()))},getMinZoom:function(){return this._minZoom},setMinZoom:function(a){this._minZoom=a,this._viewer.minZoomLevel=a*this.imgWidth/this.getViewerContainerSize().x},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(a){this._maxZoom=a,this._viewer.maxZoomLevel=a*this.imgWidth/this.getViewerContainerSize().x},getZoomStepPercent:function(){return this._zoomStepPercent},setZoomStepPercent:function(a){this._zoomStepPercent=a},setView:function(a,b,c,d){this._haveImage&&((this._viewportWidth!=a||this._viewportHeight!=b)&&this._viewer.viewport.zoomTo(1/a,null,d),(this._viewportCenter.x!=c.x||this._viewportCenter.y!=c.y)&&this._viewer.viewport.panTo(new OpenSeadragon.Point(c.x,c.y/this.imgAspectRatio),d))},getZoomFactor:function(){return this._zoomFactor},setZoomFactor:function(a,b){this._haveImage&&a!=this._zoomFactor&&a>0&&this._viewer.viewport.zoomTo(a*this.imgWidth/this.getViewerContainerSize().x,new OpenSeadragon.Point(this._viewportCenter.x,this._viewportCenter.y/this.imgAspectRatio),b)},zoomIn:function(a){var b=this._zoomFactor;b*=1+this._zoomStepPercent/100,b>this._maxZoom&&(b=this._maxZoom),this.setZoomFactor(b,a)},zoomOut:function(a){var b=this._zoomFactor;b/=1+this._zoomStepPercent/100,b<this._minZoom&&(b=this._minZoom),this.setZoomFactor(b,a)},zoomAboutLogicalPoint:function(a,b,c){this._haveImage&&a!=this._zoomFactor&&a>0&&this._viewer.viewport.zoomTo(a*this.imgWidth/this.getViewerContainerSize().x,new OpenSeadragon.Point(b.x,b.y/this.imgAspectRatio),c)},zoomInAboutLogicalPoint:function(a,b){var c=this._zoomFactor;c*=1+this._zoomStepPercent/100,c>this._maxZoom&&(c=this._maxZoom),this.zoomAboutLogicalPoint(c,a,b)},zoomOutAboutLogicalPoint:function(a,b){var c=this._zoomFactor;c/=1+this._zoomStepPercent/100,c<this._minZoom&&(c=this._minZoom),this.zoomAboutLogicalPoint(c,a,b)},centerAboutLogicalPoint:function(a,b){(this._haveImage&&this._viewportCenter.x!=a.x||this._viewportCenter.y!=a.y)&&this._viewer.viewport.panTo(new OpenSeadragon.Point(a.x,a.y/this.imgAspectRatio),b)},physicalToLogicalPoint:function(a){return new OpenSeadragon.Point(this.physicalToLogicalX(a.x),this.physicalToLogicalY(a.y))},logicalToPhysicalPoint:function(a){return new OpenSeadragon.Point(this.logicalToPhysicalX(a.x),this.logicalToPhysicalY(a.y))},physicalToLogicalX:function(a){return this._haveImage?this._viewportOrigin.x+a/this.getViewerContainerSize().x*this._viewportWidth:0},physicalToLogicalY:function(a){return this._haveImage?this._viewportOrigin.y+a/this.getViewerContainerSize().y*this._viewportHeight:0},logicalToPhysicalX:function(a){return this._haveImage?(a-this._viewportOrigin.x)/this._viewportWidth*this.getViewerContainerSize().x:0},logicalToPhysicalY:function(a){return this._haveImage?(a-this._viewportOrigin.y)/this._viewportHeight*this.getViewerContainerSize().y:0},physicalToLogicalDistance:function(a){return this._haveImage?a/this.getViewerContainerSize().x*this._viewportWidth:0},logicalToPhysicalDistance:function(a){return this._haveImage?a/this._viewportWidth*this.getViewerContainerSize().x:0},logicalToDataPoint:function(a){return new OpenSeadragon.Point(this.logicalToDataX(a.x),this.logicalToDataY(a.y))},dataToLogicalPoint:function(a){return new OpenSeadragon.Point(this.dataToLogicalX(a.x),this.dataToLogicalY(a.y))},physicalToDataPoint:function(a){return new OpenSeadragon.Point(this.physicalToDataX(a.x),this.physicalToDataY(a.y))},dataToPhysicalPoint:function(a){return new OpenSeadragon.Point(this.dataToPhysicalX(a.x),this.dataToPhysicalY(a.y))},logicalToDataX:function(a){return this._haveImage?a*this.imgWidth:0},logicalToDataY:function(a){return this._haveImage?a*this.imgHeight:0},dataToLogicalX:function(a){return this._haveImage&&this.imgWidth>0?a/this.imgWidth:0},dataToLogicalY:function(a){return this._haveImage&&this.imgHeight>0?a/this.imgHeight:0},physicalToDataX:function(a){return this._haveImage&&this.getViewerContainerSize().x>0?(this._viewportOrigin.x+a/this.getViewerContainerSize().x*this._viewportWidth)*this.imgWidth:0},physicalToDataY:function(a){return this._haveImage&&this.getViewerContainerSize().y>0?(this._viewportOrigin.y+a/this.getViewerContainerSize().y*this._viewportHeight)*this.imgHeight:0},dataToPhysicalX:function(a){return this._haveImage&&this.imgWidth>0?(a/this.imgWidth-this._viewportOrigin.x)/this._viewportWidth*this.getViewerContainerSize().x:0},dataToPhysicalY:function(a){return this._haveImage&&this.imgHeight>0?(a/this.imgHeight-this._viewportOrigin.y)/this._viewportHeight*this.getViewerContainerSize().y:0}})}(OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{});