/*!
 * pure-form - v1.2.9
 * Pure JS drop in replacement for the HTML FORM using JSON Schemas
 * https://github.com/john-doherty/pure-form
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
!function(t,e,r){"use strict";function n(t,e){var r={};return r[t]=e,this.isValid(r)}function i(){var t=this,r=this.src;t.dispatchEvent(new CustomEvent("pure-form-schema-loading",{detail:r,bubbles:!0,cancelable:!0})),M.get(r,"application/json",null,t.authToken,t.httpHeaders,function(e){t.dispatchEvent(new CustomEvent("pure-form-schema-error",{detail:e,bubbles:!0,cancelable:!0}))},function(r){t.schema=r.body,t.dispatchEvent(new CustomEvent("pure-form-schema-loaded",{detail:r,bubbles:!0,cancelable:!0}));var n=T((t.schema||{}).links||[],"rel","original",!0);if(n&&""!==n.href)a.call(t,n.href);else{t._originalValue=m.call(t);var i=e[t.storage];t.persist&&i&&p(i,t.src,function(e){e&&d.call(t,JSON.parse(e))})}})}function a(t){var e=this;e.dispatchEvent(new CustomEvent("pure-form-data-loading",{detail:t,bubbles:!0,cancelable:!0})),M.get(t,"application/json",null,e.authToken,e.httpHeaders,function(t){e.dispatchEvent(new CustomEvent("pure-form-data-error",{detail:t,bubbles:!0,cancelable:!0}))},function(t){e.value=t.body,e.dispatchEvent(new CustomEvent("pure-form-data-loaded",{detail:t,bubbles:!0,cancelable:!0}))})}function s(){if(this.schema&&"object"==typeof this.schema){var t=this,e=this.schema.properties,r=C(this.schema),i=null;this.form&&this.form.parentElement&&this.form.parentElement.removeChild(this.form),this.useFormTag?(this.form=A(null,"form",{enctype:this.enctype,action:this.action,method:this.method,novalidate:"novalidate",class:"pure-form-form"}),this.form.onsubmit=function(e){t.dispatchEvent(new CustomEvent("pure-form-submit",{bubbles:!0,cancelable:!0}))&&t.disableValidation&&t.isValid()||e.preventDefault()}):this.form=A(null,"div",{class:"pure-form-form"}),this.form.addEventListener("focusout",function(e){var r=e.target;if(t.validateOnBlur&&"submit"!==r.type&&"button"!==r.type&&"checkbox"!==r.type){var i=r.value;"IFRAME"===r.tagName&&r.contentDocument&&r.contentDocument.body&&(i=r.contentDocument.body.innerHTML||""),n.call(t,r.id,i)}},!0),t.enforceMaxLength&&this.form.addEventListener("keydown",function(t){(t.keyCode>47&&t.keyCode<58||t.keyCode>64&&t.keyCode<91||t.keyCode>95&&t.keyCode<112)&&t.target.value.length===t.target.maxLength&&t.preventDefault()}),this.form.addEventListener("keyup",function(e){var r=e.target;if(13===e.keyCode&&("INPUT"===r.tagName||"TEXTAREA"===r.tagName||"SELECT"===r.tagName))if(t.tabOnEnter){e.preventDefault();var n=Array.prototype.slice.call(t.form.querySelectorAll(".pure-form-item"));n.forEach(function(t,e){r===t&&n[e+1]&&n[e+1].focus()})}else if(t.submitOnEnter){e.preventDefault();var i=(t.querySelectorAll(".pure-form-button")||[])[0];i&&g(i,j?"touchend":"click")}c(r),t.autoResize&&y.call(t)}),this.form.addEventListener("change",function(t){var e=t.target;if(e&&"INPUT"===e.tagName&&"file"===e.type&&!e.data){t.preventDefault(),t.stopPropagation();var r=Array.prototype.slice.call(t.target.files);e.data=e.data||[],r.forEach(function(t,r){N(t,function(t){e.data[r]=t,g(e,"change")})})}}),r=r.filter(function(t){return"links"!==t&&-1===t.indexOf("$")&&e.hasOwnProperty(t)});for(var a=0;a<r.length;a++){var s=r[a],o=e[s];i=A(null,"label",{for:s,class:"pure-form-label"}),o.format&&i.setAttribute("data-format",o.format),o.type&&i.setAttribute("data-type",o.type),o.required&&i.setAttribute("data-required",!0),A(i,"span",{class:"pure-form-label-text"},o.title||s);var u=b.call(this,s,o);if(!u)throw new Error("Failed to convert schema item to html element (key:"+s+")");var m="hidden"===u.type;this.readonly&&(u.setAttribute("readonly","true"),"SELECT"===u.tagName&&u.setAttribute("disabled","true")),m||(u.className="pure-form-item"),s===t.autofocusId&&u.setAttribute("autofocus","true"),m?this.form.appendChild(u):(i.appendChild(u),o.description&&o.description.length>this.placeholderMaxLength&&A(i,"span",{class:"pure-form-item-description"},o.description||""),c(u),this.form.appendChild(i)),this.appendChild(this.form)}l.call(this),t.dispatchEvent(new CustomEvent("pure-form-render-complete",{bubbles:!0,cancelable:!0}))}}function o(){if(""!==this.title){var t=this.querySelector(".pure-form-title")||A(null,"div",{class:"pure-form-title"});t.textContent=this.title,t.parentElement||this.insertBefore(t,this.form)}else O(this,".pure-form-title")}function u(){if(""!==this.description){var t=this.querySelector(".pure-form-description")||A(null,"div",{class:"pure-form-description"});t.textContent=this.description,t.parentElement||this.insertBefore(t,this.form)}else O(this,".pure-form-description")}function l(){var t=this,e=this.showSchemaButtons&&this.schema&&Array.isArray(this.schema.links)?this.schema.links:[];if(e=e.filter(function(t){return"original"!==t.rel}),this.form&&(""!==this.buttons||e.length>0)){var r=this.buttons.split(",").filter(Boolean),n=this.form.querySelector(".pure-form-buttons");n?n.innerHTML="":(n=A(this.form,"div",{class:"pure-form-buttons"})).addEventListener(H,function(e){var r=e.target;if("INPUT"===r.tagName&&!t.__dragging){var n={value:r.value,link:null};switch(r.type){case"submit":t.dispatchEvent(new CustomEvent("pure-form-button-clicked",{detail:{value:r.value},bubbles:!0,cancelable:!0}));break;case"button":var i=r.getAttribute("data-rel");n.link=t.schema&&Array.isArray(t.schema.links)?T(t.schema.links,"rel",i,!0):null,t.dispatchEvent(new CustomEvent("pure-form-button-clicked",{detail:n,bubbles:!0,cancelable:!0}))}}}),r.forEach(function(t){A(n,"input",{type:"submit",value:t.trim(),class:"pure-form-button"})}),(e=e.filter(function(t){return"instances"!==t.rel})).forEach(function(t){var e=(t.title||t.rel).trim();A(n,"input",{type:"button","data-rel":t.rel,value:e,class:"pure-form-button"})})}else O(this,".pure-form-buttons")}function c(t){var e=parseInt(t.getAttribute("maxlength")||t.getAttribute("data-maxlength")||"0",10),r=E(t,"tagName","LABEL");if("TEXTAREA"===t.tagName&&r&&e>0){var n=t.value.length;r.setAttribute("data-max-length",e),e>0?t.parentElement.setAttribute("data-characters-remaining",e-n):t.parentElement.removeAttribute("data-characters-remaining"),t.removeAttribute("data-valid"),r.removeAttribute("data-error")}}function m(){var t=this,e=(this.schema||{}).properties||{},r={};return Object.keys(e).forEach(function(n){if(!("links"===n&&n.indexOf("$")>-1)){var i=e[n],a=t.querySelector('[name="'+n+'"]');if(a)switch(i.type){case"array":"textarea"===i.items.format?r[n]=""!==a.value?a.value.split("\n"):[]:"uri"===i.items.format?r[n]=a.data:(Array.isArray(a.value),r[n]=a.value);break;case"boolean":r[n]=a.checked;break;case"integer":r[n]=a.value?parseInt(a.value,10):"";break;case"number":r[n]=a.value?parseFloat(a.value):"";break;default:var s=i.format||"";"html"===s?r[n]=a.contentDocument?(a.contentDocument.body.innerHTML||"").trim():"":0===s.indexOf("custom:")&&"file"===a.type&&a.files&&a.files[0]?r[n]=1===a.files.length?a.data[0]:a.data:r[n]=(a.value||"").trim(),i.maxLength&&(r[n]=r[n].substr(0,Math.max(i.maxLength,0)))}i.required||""!==r[n]||delete r[n]}}),r}function h(){if(!this.schema)return null;var t=this,e=t.schema.properties,r={};return Object.keys(e).filter(function(t){return"links"!==t&&-1===t.indexOf("$")&&!e[t].readonly}).forEach(function(n){var i=e[n],a=t.querySelector('[name="'+n+'"]');if(a&&"file"!==a.type)switch(i.type){case"array":"uri"===i.items.format||"object"===i.items.type?r[n]=a.data:r[n]=a.value;break;case"boolean":r[n]=a.checked;break;case"string":"html"===i.format&&a.contentDocument?r[n]=a.contentDocument.body.innerHTML||"":r[n]=(a.value||"").trim();break;default:r[n]=(a.value||"").trim()}}),r}function f(t){if(t){var e=this,n=m.call(this),i=t.href||r.location.href,a=(t.method||"POST").toLowerCase(),s=t.enctype||"application/json";e.clearErrors(),M[a](i,s,n,e.authToken,e.httpHeaders,function(t){e.dispatchEvent(new CustomEvent("pure-form-submit-error",{detail:t,bubbles:!0,cancelable:!0}))},function(t){var r=T((t.body||{}).links||[],"rel","describedby:next",!0)||{},n=r.method||"GET",i=r.href||"";"GET"===n&&""!==i?e.src=i:t.body&&t.body.$schema?e.schema=t.body:e.dispatchEvent(new CustomEvent("pure-form-submit-complete",{detail:t,bubbles:!0,cancelable:!0}))})}}function d(t){var e=this,r=t,n={oldValue:this.value,newValue:r};e.dispatchEvent(new CustomEvent("pure-form-value-set",{detail:n,bubbles:!0,cancelable:!0}))&&(Object.keys(r).forEach(function(t){var n=e.querySelector('[name="'+t+'"]'),i=void 0!==r[t]?r[t]:"";n&&(L.call(e,n,i),e.schema.properties[t].maxLength&&c(n))}),e.autoResize&&y.call(e),e.dispatchEvent(new CustomEvent("pure-form-value-set-complete",{detail:n,bubbles:!0,cancelable:!0})))}function b(t,e){var r=this,n=null,i=e.items&&e.items.type||e.type,a=(e.items&&e.items.format||e.format||"").toLowerCase();switch(S(a,I.customURC)&&(i=""),i){case"number":case"integer":if(Number.isInteger(e.minimum)&&Number.isInteger(e.maximum)){A(n=A(null,"select",{name:t,id:t}),"option",{value:""});for(var s=e.minimum;s<=e.maximum;s++)A(n,"option",{value:s},s)}else n=A(null,"input",{name:t,id:t,type:"number",value:""});break;case"boolean":n=A(null,"input",{name:t,id:t,type:"checkbox",value:"1"});break;default:if(Array.isArray(e.enum))A(n=A(null,"select",{name:t,id:t}),"option",{value:""}),e.enum.forEach(function(t){A(n,"option",{value:t},t)});else switch(a){case"url":case"uri":n=A(null,"input",{name:t,id:t,type:"url",value:""});break;case"textarea":n=A(null,"textarea",{name:t,id:t,value:"",rows:3});break;case"html":n=A(null,"iframe",{name:t,id:t,frameborder:0,src:"about:blank"});break;case"date":n=A(null,"input",{name:t,id:t,type:"date",value:""});break;case"password":n=A(null,"input",{name:t,id:t,type:"password",value:"",autocomplete:"new-password"});break;case"email":n=A(null,"input",{name:t,id:t,type:"email",pattern:I.email,value:""});break;default:if(S(a,I.customURC)){var o=I.customURC.exec(a);if(!o||3!==o.length)throw new Error("Invalid custom format on field "+t);var u=o[1],l=(o[2]||"").split(",").filter(Boolean);n=A(null,u,{name:t,id:t}),l.forEach(function(t){var e=t.split("="),r=e[0],i=e[1];n.setAttribute(r,i)})}else n=A(null,"input",{name:t,id:t,type:"text",value:""})}}return n&&(n.getAttribute("autocomplete")||n.setAttribute("autocomplete","off"),(r.readonly||e.readonly)&&(n.setAttribute("readonly","true"),n.setAttribute("tabindex","-1"),n.setAttribute("disabled","disabled")),(r.readonly||e.readonly)&&"SELECT"===n.tagName&&n.setAttribute("disabled","true"),e.required&&n.setAttribute("required","required"),e.pattern&&n.setAttribute("pattern",e.pattern),e.min&&n.setAttribute("min",e.min),e.max&&n.setAttribute("max",e.max),e.minLength&&n.setAttribute("minlength",e.minLength),e.maxLength&&n.setAttribute(this.enforceMaxLength?"maxlength":"data-maxlength",e.maxLength),e.minItems&&n.setAttribute("min-items",e.minItems),e.maxItems&&n.setAttribute("max-items",e.maxItems),e.description&&e.description.length<this.placeholderMaxLength&&n.setAttribute("placeholder",e.description||""),"boolean"===e.type&&e.readonly&&n.setAttribute("disabled","true"),void 0!==e.default&&L.call(r,n,e.default)),n}function p(t,r,n){if("function"!=typeof n)throw new Error("Invalid callback handler");var i=t.getItem(r);i instanceof e.Promise?i.then(n):n(i)}function v(t,r,n,i){var a=t.setItem(r,n);a instanceof e.Promise&&i?a.then(i):i&&i()}function g(t,e){if(e=e.replace(/on/,""),r.createEvent){var n=r.createEvent("Event");n.initEvent(e,!0,!0),t.dispatchEvent(n)}else r.createEventObject?t.fireEvent("on"+e):"function"==typeof t["on"+e]&&t["on"+e]()}function y(){Array.prototype.slice.call(this.querySelectorAll("iframe")).forEach(function(t){var e=t.contentDocument.body;e.scrollHeight>e.clientHeight&&(t.style.height=e.scrollHeight+35+"px")}),Array.prototype.slice.call(this.querySelectorAll("textarea")).forEach(function(t){t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+35+"px")})}function E(t,e,r){r="className"===(e="class"===e?"className":e)?"(^|\\s)"+r+"(\\s|$)":r;for(var n=t.parentNode;null!==n&&n.tagName&&"html"!==n.tagName.toLowerCase();){if(n[e]===r||n.getAttribute(e)===r||"className"===e&&n[e].matches(r))return n;n=n.parentNode}return null}function A(t,e,n,i,a){var s=r.createElement(e),o=e.indexOf("-")>0;return t="string"==typeof t&&""!==t?r.querySelector(t):t,n=n||{},Object.keys(n).forEach(function(t){"class"===t?s.className=n[t]:"style"===t?s.setAttribute("style",n[t]):"id"===t?s.id=n[t]:"name"===t?s.setAttribute(t,n[t]):o||t in s?s[t]=n[t]:s.setAttribute(t,n[t])}),void 0!==i&&"object"!=typeof i&&s.appendChild(r.createTextNode(i)),void 0!==a&&(s.innerHTML="",k(a,s)),t&&t.appendChild(s),s}function k(t,e){e=e||r.createDocumentFragment();var n=null,i=r.createElement("div");i.innerHTML=t;for(var a=i.getElementsByTagName("script"),s=a.length-1;s>=0;s--)a[s].parentElement.removeChild(a[s]);for(;n=i.firstChild;)e.appendChild(n);return e}function x(t,e,r,n){var i=w(t,e,!0),a=(r+"").length;if(i){if(r&&"string"===i.type&&"email"===i.format&&!S(r.toString(),I.email))return"Invalid email address";if(r&&i.minLength&&a<i.minLength)return"The value must have a minimum of "+i.minLength+" character(s)";if(r&&i.maxLength&&a>i.maxLength)return"Maximum "+i.maxLength+" character"+(a>1?"s":"");if(!n&&i.required&&("boolean"!==i.type&&!r||Array.isArray(r)&&r.length<=0))return"This field must have a value";if(i.minItems&&Array.isArray(r)&&r.length<i.minItems)return"Please select at least "+i.minItems+" item(s)";if(i.maxItems&&Array.isArray(r)&&r.length>i.maxItems)return"Please select a maximum of "+i.maxItems+" item(s)";if(r&&i.pattern&&!S(r.toString(),i.pattern))return"The value is not in the expected format";if(r&&i.minimum&&parseInt(r,10)<i.minimum)return"The value must not be lower than "+i.minimum;if(r&&i.maximum&&parseInt(r,10)>i.maximum)return"The value must not be higher than "+i.maximum;if(r&&"integer"===i.type&&!/^[0-9]+$/.test(r.toString()))return"The value must be a whole number";if(r&&"number"===i.type&&!/^[0-9.]+$/.test(r.toString()))return"The value must be a number"}return null}function w(t,e,r){if(void 0===t)return!1;(r=void 0!==t.$schema||r)&&(t.properties&&e.indexOf(".properties")<=-1?e="properties."+e:t.items&&e.indexOf(".items")<=-1&&(e="items."+e));var n=e.indexOf(".");return n>-1?(t=t[e.substring(0,n)],e=e.substr(n+1),w(t,e,r)):t[e]}function C(t){t=t.properties||t;var e=Object.keys(t);return e.sort(function(e,r){return parseFloat((t[e].id||"0").replace(/[^0-9.]+/gi,""))-parseFloat((t[r].id||"0").replace(/[^0-9.]+/gi,""))}),e}function L(t,e){var r=t?t.tagName.toLowerCase():"",n=t.type||"";switch(r){case"input":"checkbox"===n?t.checked=!0===e:"file"===n?(t.type="",t.value=e,t.type="file",delete t.data):t.value=e;break;case"textarea":t.value=e.join?e.join("\n"):e;break;case"div":t.innerHTML=e||"";break;case"iframe":if(t.contentDocument){var i=t.contentDocument.body;i.innerHTML="",k(e||"",i)}break;default:t.value=e}}function T(t,e,r,n){for(var i=[],a=0,s=(t=t||[]).length;a<s;a++)if(t[a][e]===r){if(n)return t[a];i.push(t[a])}return n?null:i}function O(t,e){var n=(t||r).querySelector(e);n&&n.parentElement.removeChild(n)}function S(t,e){return(e.constructor!==RegExp?new RegExp(e,"g"):e).test(t)}function N(t,e){var r=new FileReader;r.onload=function(){e(r.result.split(",").pop())},r.readAsDataURL(t)}function q(t,r){if(!t||""===t)throw new Error("Please provide a css class name");var n=e.document.styleSheets,i={};try{for(var a=0,s=n.length;a<s;a++)for(var o=n[a].rules||n[a].cssRules||[],u=0,l=o.length;u<l;u++){var c=o[u].selectorText||"",m=o[u].cssText||o[u].style.cssText||"";(r&&0===c.indexOf(t)||c===t)&&(i[c]=m.split(/(?:{|})/)[1].trim())}}catch(t){}return Object.keys(i).length>0?i:null}var j="ontouchstart"in e||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,H=j?"touchend":"click",I={email:/^[a-zA-Z0-9-_.]{1,}@[a-zA-Z0-9.-]{2,}[.]{1}[a-zA-Z]{2,}$/,customURC:/^custom:([a-z0-9-]*)(?:;|)([a-z0-9-=/*,.()\[\]]+|)$/i},D=Object.create(t,{action:{get:function(){return this.getAttribute("action")||""},set:function(t){this.setAttribute("action",t||"")}},enctype:{get:function(){return this.getAttribute("enctype")||"application/x-www-form-urlencoded"},set:function(t){this.setAttribute("enctype",t||"application/x-www-form-urlencoded")}},method:{get:function(){return this.getAttribute("method")||"get"},set:function(t){this.setAttribute("method",t||"get")}},src:{get:function(){return this.getAttribute("src")||""},set:function(t){this.setAttribute("src",t||"")}},schema:{get:function(){return this._schema||null},set:function(t){this._schema=t,this.title=this._schema.title,this.description=this._schema.description,t.id?this.setAttribute("schema-id",t.id):this.removeAttribute("schema-id"),this.dispatchEvent(new CustomEvent("pure-form-schema-set",{bubbles:!0,cancelable:!0})),s.call(this)}},value:{get:function(){return m.call(this)},set:function(t){d.call(this,t),this._originalValue=m.call(this)}},isDirty:{get:function(){return!!this._originalValue&&JSON.stringify(this._originalValue)!==JSON.stringify(m.call(this))}},readonly:{get:function(){return"true"===this.getAttribute("readonly")},set:function(t){t?this.setAttribute("readonly",t):this.removeAttribute("readonly")}},title:{get:function(){return this.getAttribute("data-title")||""},set:function(t){this.setAttribute("data-title",t||"")}},description:{get:function(){return this.getAttribute("description")||""},set:function(t){this.setAttribute("description",t||"")}},buttons:{get:function(){return this.getAttribute("buttons")||""},set:function(t){t=t.split(",").filter(Boolean).join(","),this.setAttribute("buttons",t)}},links:{get:function(){return(this.schema||{}).links||[]},set:function(t){if(!Array.isArray(t))throw new Error("Schema links must be an array");if(!this.schema)throw new Error("Unable to assign schema.links");t.forEach(function(t){if(!t.title||""===t.title)throw new Error("Link object must have a title property");if(!t.rel||""===t.rel)throw new Error("Link object must have a rel property")}),this.schema.links=t,l.call(this)}},persist:{get:function(){return"true"===this.getAttribute("persist")},set:function(t){this.setAttribute("persist",!0===t)}},storage:{get:function(){return this.getAttribute("storage")||"sessionStorage"},set:function(t){this.setAttribute("storage",t||"sessionStorage")}},disableValidation:{get:function(){return"true"===this.getAttribute("disable-validation")},set:function(t){this.setAttribute("disable-validation",!0===t)}},placeholderMaxLength:{get:function(){return parseInt(this.getAttribute("placeholder-max-length")||"75",10)},set:function(t){this.setAttribute("placeholder-max-length",t)}},autofocusError:{get:function(){return"true"===this.getAttribute("autofocus-error")},set:function(t){this.setAttribute("autofocus-error",!0===t)}},validateOnBlur:{get:function(){return"true"===this.getAttribute("validate-on-blur")},set:function(t){this.setAttribute("validate-on-blur",!0===t),t&&(this.autofocusError=!1)}},tabOnEnter:{get:function(){return"true"===this.getAttribute("tab-on-enter")},set:function(t){this.setAttribute("tab-on-enter",!0===t)}},submitOnEnter:{get:function(){return"true"===this.getAttribute("submit-on-enter")},set:function(t){this.setAttribute("submit-on-enter",!0===t)}},useFormTag:{get:function(){return"false"!==this.getAttribute("use-form-tag")},set:function(t){this.setAttribute("use-form-tag",!0===t)}},enforceMaxLength:{get:function(){return"true"===this.getAttribute("enforce-max-length")},set:function(t){this.setAttribute("enforce-max-length",!0===t)}},schemaId:{get:function(){return this.getAttribute("schema-id")||""}},autoResize:{get:function(){return"true"===this.getAttribute("auto-resize")},set:function(t){this.setAttribute("auto-resize",!0===t)}},autofocusId:{get:function(){return this.getAttribute("autofocus-id")||""},set:function(t){this.setAttribute("autofocus-id",t||"")}},authToken:{get:function(){return this.getAttribute("auth-token")||""},set:function(t){this.setAttribute("auth-token",t||"")}},showSchemaButtons:{get:function(){return"false"!==this.getAttribute("show-schema-buttons")},set:function(t){this.setAttribute("show-schema-buttons",!0===t)}},httpHeaders:{get:function(){var t=this.getAttribute("http-headers")||"";if(""!==t){var e={};return t.split(";").forEach(function(t){var r=t.split("=");e[r[0]]=r[1]}),e}return null},set:function(t){if("object"!=typeof t)throw new Error("httpHeaders must be a key/value object");var e=[];Object.keys(t).forEach(function(r){e.push(r+"="+t[r])}),this.setAttribute("http-headers",e.join(";"))}}});D.createdCallback=function(){var t=this;Array.prototype.slice.call(t.attributes).forEach(function(e){t.attributeChangedCallback(e.name,null,e.value)}),t.addEventListener("pure-form-button-clicked",function(e){var r=e.detail.link;r&&(0===r.rel.toLowerCase().indexOf("describedby:")?this.src=r.href:t.isValid()&&t.dispatchEvent(new CustomEvent("pure-form-submit",{detail:{link:r},bubbles:!0,cancelable:!0}))&&f.call(this,r))}),t.addEventListener("change",function(r){r.preventDefault(),t.dispatchEvent(new CustomEvent("pure-form-value-changed",{detail:{srcElement:r.target},bubbles:!0,cancelable:!0}));var n=e[t.storage];if(t.persist&&n){var i=h.call(t);i&&v(n,t.src,JSON.stringify(i))}}),t.addEventListener("pure-form-value-set-complete",function(r){var n=e[t.storage];if(t.persist&&n){var i=h.call(t);i&&v(n,t.src,JSON.stringify(i))}});var r=q("pure-form .pure-form-html ",!0),n=Object.keys(r||{}).map(function(t){return t.replace("pure-form .pure-form-html ","")+"{"+r[t]+"}"}).join("\n");t.addEventListener("pure-form-render-complete",function(e){Array.prototype.slice.call(t.querySelectorAll("iframe")).forEach(function(e){""!==n&&(e.contentDocument.head.innerHTML="<style>"+n+"</style>"),e.contentDocument.body.scrollHeight>e.contentDocument.body.clientHeight&&(e.style.height=e.contentDocument.body.scrollHeight+35+"px"),"true"!==e.getAttribute("readonly")&&(e.contentDocument.body.contentEditable=!0),e.contentDocument.body.addEventListener("keyup",function(r){y.call(t),e.dispatchEvent(new CustomEvent("change",{bubbles:!0,cancelable:!0}))}),e.contentDocument.body.addEventListener("blur",function(t){e.dispatchEvent(new CustomEvent("focusout",{bubbles:!0,cancelable:!0}))})})}),t.addEventListener("pure-form-schema-loading",function(e){t.setAttribute("schema-loading","true")}),t.addEventListener("pure-form-schema-loaded",function(e){t.removeAttribute("schema-loading")}),t.addEventListener("pure-form-data-loading",function(e){t.setAttribute("data-loading","true")}),t.addEventListener("pure-form-data-loaded",function(e){t.removeAttribute("data-loading")}),j&&(t.addEventListener("touchstart",function(){t.__dragging=!1},{passive:!0}),t.addEventListener("touchmove",function(){t.__dragging=!0},{passive:!0}),t.addEventListener("touchend",function(){t.__dragging=!1},{passive:!0}))},D.attributeChangedCallback=function(t,e,r){if(e!==r)switch(t){case"src":i.call(this);break;case"data-title":o.call(this);break;case"description":u.call(this);break;case"buttons":case"show-schema-buttons":l.call(this);break;case"readonly":case"enctype":case"action":case"use-form-tag":case"enforce-maxlength":var n=this.value;s.call(this),this.value=n}},D.clearError=function(t){var e=this.querySelector('[name="'+t+'"]');e&&(e.setAttribute("data-valid","true"),e.parentNode.removeAttribute("data-error"))},D.clearErrors=function(){this.form.removeAttribute("data-error"),Array.prototype.slice.call(this.querySelectorAll("[data-error]")).forEach(function(t){t.removeAttribute("data-error")}),Array.prototype.slice.call(this.querySelectorAll("[data-valid]")).forEach(function(t){t.removeAttribute("data-valid")})},D.setError=function(t,e){var r=this.querySelector('[name="'+t+'"]');r&&(r.setAttribute("data-valid","false"),r.parentNode.setAttribute("data-error",e))},D.isValid=function(t,e,r){if(this.disableValidation)return!0;t=t||m.call(this);var n=this,i=this.schema,a=!0;if(Object.keys(t).forEach(function(s){var o=n.querySelector('[name="'+s+'"]'),u=i.properties[s],l="";l=(u?u.pattern:null)&&o?o.value:t[s];var c=x(i,s,l,r);e?c&&(a=!1):c?(n.setError(s,c),a=!1):n.clearError(s)}),!e&&this.autofocusError){var s=this.querySelector('form [data-valid="false"]');s&&s.focus()}return e||(a?this.dispatchEvent(new CustomEvent("pure-form-validation-passed",{bubbles:!0,cancelable:!0})):this.dispatchEvent(new CustomEvent("pure-form-validation-failed",{bubbles:!0,cancelable:!0}))),a},D.checkValid=function(t,e){return x(this.schema,t,e)},D.reset=function(){var t={},e=(this.schema||{}).properties||{};Object.keys(e).filter(function(t){return"links"!==t&&t.indexOf("$")<=-1}).forEach(function(r){t[r]=void 0!==e[r].default?e[r].default:""}),this.value=t},D.submit=function(t){if(this.disableValidation||this.isValid()){if(t){var e=this.schema&&Array.isArray(this.schema.links)?T(this.schema.links,"rel",t,!0):null;e&&this.dispatchEvent(new CustomEvent("pure-form-submit",{bubbles:!0,cancelable:!0}))&&f.call(this,e)}else this.form&&"FORM"===this.form.tagName&&"function"==typeof this.form.submit&&this.dispatchEvent(new CustomEvent("pure-form-submit",{bubbles:!0,cancelable:!0}))&&this.form.submit()}},"initCustomEvent"in r.createEvent("CustomEvent")&&(e.CustomEvent=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=r.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n},e.CustomEvent.prototype=e.Event.prototype);var M=function(){function t(t){try{JSON.parse(t)}catch(t){return!1}return!0}function e(t){return Object.keys(t||{}).map(function(e){return encodeURI(e+"="+t[e])}).join("&")}function r(r,n,i,a,s,o,u,l){var c="withCredentials"in new XMLHttpRequest?new XMLHttpRequest:new XDomainRequest;if(c){if(r=r||"GET",i=i||"application/json",s=s||"",c.open(r,n),c.withCredentials=!0,c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-Type",i),Object.keys(o||{}).forEach(function(t){c.setRequestHeader(t,o[t])}),c.overrideMimeType&&c.overrideMimeType("application/json"),""!==s&&c.setRequestHeader("Authorization","Bearer "+s),c.onreadystatechange=function(){if(4===c.readyState){var e=t(c.responseText)?JSON.parse(c.responseText):c.responseText;c.status>=200&&c.status<=300||0===c.status&&""!==c.responseText?l({url:n,status:c.status,body:e}):u({url:n,status:c.status,body:e})}},a)switch(i){case"application/x-www-form-urlencoded":a=e(a);break;default:a=JSON.stringify(a)}c.send(a||null)}}return{get:function(t,e,n,i,a,s,o){r("GET",t,e,n,i,a,s,o)},post:function(t,e,n,i,a,s,o){r("POST",t,e,n,i,a,s,o)},put:function(t,e,n,i,a,s,o){r("PUT",t,e,n,i,a,s,o)},patch:function(t,e,n,i,a,s,o){r("PATCH",t,e,n,i,a,s,o)},delete:function(t,e,n,i,a,s,o){r("DELETE",t,e,n,i,a,s,o)}}}();if(!r.registerElement)throw new Error("document.registerElement does not exist. Are you missing the polyfill?");r.registerElement("pure-form",{prototype:D})}(HTMLElement.prototype,this,document);