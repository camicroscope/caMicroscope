{"version":3,"sources":["pathdb_package.js"],"names":["PathDbMods","getCookie","key","cookiestring","RegExp","exec","document","cookie","decodeURIComponent","toString","replace","console","log","fetch","method","credentials","then","x","json","hasOwnProperty","token","warn","Store","prototype","default_findMark","findMark","slide","name","specimen","study","footprint","source","x0","x1","y0","y1","url","base","query","objToParamStr","mode","errorHandler","filterBroken","getMarkByIds","ids","Array","isArray","hasError","message","suffix","stringifiedIds","map","id","join","findMarkTypes","parseInt","parseFloat","error","default_findSlide","findSlide","location","headers","Headers","response","ok","text","statusText","default_getCollection","getCollection","collectionId","default_getSlide","getSlide","default_findHeatmapType","findHeatmapType","default_findHeatmap","findHeatmap","default_getHeatmap","getHeatmap","StatesHelper","default_getCurrentStatesURL","getCurrentStatesURL","isImageCoordinate","states","getCurrentStates","encodeStates","origin","pathname","$D","params","slideId","CaMic","default_loadImg","loadImg","func","pathdb_id","URLSearchParams","window","search","get","slideName","collection","subject_id","image_id","study_id","store","data","mpp","field_mpp_y","length","mpp_y","value","field_mpp_x","mpp_x","referencepixelphysicalvaluey","referencepixelphysicalvaluex","field_subject_id","clinicaltrialsubjectid","field_image_id","imageid","field_study_id","studyid","field_collection","target_id","pdb_hm_name","field_iip_path","viewer","open","createScalebar","OpenSeadragonImaging","ImagingHelper","setMaxZoom","cdata","fullLabel","call","Loading","textContent","catch","e"],"mappings":"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","file":"pathdb_package.js","sourceRoot":"../package","sourcesContent":["function PathDbMods() {\n  console.log(\"PathDbMods()...\");\n  // put the auth jwt in cookie as token\n  fetch(\"/jwt/token\", {\n    method: 'GET',\n    credentials: 'include'\n  }).then(x => x.json()).then(x => {\n    console.log(x)\n    if (x.hasOwnProperty('token') && x.token) {\n      document.cookie = \"token=\" + x.token + \";\"\n    }\n  })\n  /**\n  Gets a named cookie value\n  * @param {string} key - the key to get from the cookie\n  **/\n  function getCookie(key) {\n    var cookiestring = RegExp(\"\" + key + \"[^;]+\").exec(document.cookie);\n    return decodeURIComponent(!!cookiestring ? cookiestring.toString().replace(/^[^=]+./, \"\") : \"\");\n  }\n  console.warn(\"{PathDB mods enabled}\")\n  Store.prototype.default_findMark = Store.prototype.findMark\n  Store.prototype.findMark = function(slide, name, specimen, study, footprint, source, x0, x1, y0, y1) {\n    var suffix = \"Mark/find\"\n    var url = this.base + suffix;\n    var query = {}\n    if (slide) {\n      query.slide = slide\n    }\n    if (name) {\n      query.name = name\n    }\n    if (specimen) {\n      query.specimen = specimen\n    }\n    if (study) {\n      query.study = study\n    }\n    if (footprint) {\n      query.footprint = footprint\n    }\n    if (source) {\n      query.source = source\n    }\n    if (x0) {\n      query.x0 = x0;\n    }\n    if (x1) {\n      query.x1 = x1;\n    }\n    if (y0) {\n      query.y0 = y0;\n    }\n    if (y1) {\n      query.y1 = y1;\n    }\n    return fetch(url + \"?\" + objToParamStr(query), {\n      credentials: \"same-origin\",\n      mode: \"cors\"\n    }).then(this.errorHandler).then(x => this.filterBroken(x, \"mark\"))\n  }\n  Store.prototype.getMarkByIds = function(ids, slide, study, specimen, source, footprint, x0, x1, y0, y1) {\n    if (!Array.isArray(ids) || !slide) {\n      return {\n        hasError: true,\n        message: 'args are illegal'\n      }\n    }\n    var suffix = \"Mark/multi\"\n    var url = this.base + suffix;\n    var query = {}\n    var stringifiedIds = ids.map(id => `\"${id}\"`).join(',');\n    query.name = `[${stringifiedIds}]`;\n    query.slide = slide;\n    if (study) {\n      query.study = study;\n    }\n    if (specimen) {\n      query.specimen = specimen;\n    }\n    if (source) {\n      query.source = source;\n    }\n    if (footprint) {\n      query.footprint = footprint;\n    }\n    if (x0) {\n      query.x0 = x0;\n    }\n    if (x1) {\n      query.x1 = x1;\n    }\n    if (y0) {\n      query.y0 = y0;\n    }\n    if (y1) {\n      query.y1 = y1;\n    }\n    return fetch(url + \"?\" + objToParamStr(query), {\n      credentials: \"same-origin\",\n      mode: \"cors\"\n    }).then(this.errorHandler).then(x => this.filterBroken(x, \"mark\"))\n  }\n  Store.prototype.findMarkTypes = function(slide, name) {\n    var suffix = \"Mark/types\"\n    var url = this.base + suffix;\n    var query = {}\n    if(!slide) {\n      console.error('Store.findMarkTypes needs slide ... ');\n      return null;\n    }\n    // pathdb numeric->str coerce\n    if ((parseInt(slide)==slide)||(parseFloat(slide)==slide)){\n      query.slide = '\"' + slide + '\"'\n    } else {\n      query.slide = slide\n    }\n\n    if (name) {\n      query.name = name\n      suffix = \"Mark/typesExec\"\n    }\n    return fetch(url + \"?\" + objToParamStr(query), {\n      credentials: \"same-origin\",\n      mode: \"cors\"\n    }).then(this.errorHandler)\n  }\n  Store.prototype.default_findSlide = Store.prototype.findSlide;\n  Store.prototype.findSlide = function(slide, specimen, study, location) {\n    var url = \"/node/\" + slide + \"?_format=json\"\n    return fetch(url, {\n      mode: \"cors\",\n      headers: new Headers({\n        'Authorization': 'Bearer ' + getCookie(\"token\"),\n      })\n    }).then(function(response) {\n      if (!response.ok) return {\n        error: !response.ok,\n        text: response.statusText,\n        url: response.url\n      };\n      return response.json().then(x => [x]);\n    })\n  }\n  Store.prototype.default_getCollection = Store.prototype.getCollection;\n  Store.prototype.getCollection = function(collectionId) {\n    var url = \"/taxonomy/term/\" + collectionId + \"?_format=json\"\n    return fetch(url, {\n      mode: \"cors\",\n      headers: new Headers({\n        'Authorization': 'Bearer ' + getCookie(\"token\"),\n      })\n    }).then(function(response) {\n      if (!response.ok) return {\n        error: !response.ok,\n        text: response.statusText,\n        url: response.url\n      };\n      return response.json().then(x => [x]);\n    })\n  }\n  Store.prototype.default_getSlide = Store.prototype.getSlide\n  Store.prototype.getSlide = function(id) {\n    var url = \"/node/\" + id + \"?_format=json\"\n    return fetch(url, {\n      mode: \"cors\",\n      headers: new Headers({\n        'Authorization': 'Bearer ' + getCookie(\"token\"),\n      })\n    }).then(function(response) {\n      if (!response.ok) return {\n        error: !response.ok,\n        text: response.statusText,\n        url: response.url\n      };\n      return response.json().then(x => [x]);\n    })\n  }\n\n\n  Store.prototype.default_findHeatmapType = Store.prototype.findHeatmapType;\n  Store.prototype.findHeatmapType = function(slide, name) {\n    var suffix = \"Heatmap/types\"\n    var url = this.base + suffix;\n    var query = {}\n    query.slide = slide\n    query.specimen = \"\"\n    query.study = \"\"\n    if(name) query.name = name;\n\n    return fetch(url + \"?\" + objToParamStr(query), {\n      credentials: \"include\",\n      mode: \"cors\"\n    }).then(this.errorHandler).then(x=>this.filterBroken(x, \"heatmap\"))\n\n  };\n\n  Store.prototype.default_findHeatmap = Store.prototype.findHeatmap;\n  Store.prototype.findHeatmap = function(slide, name) {\n    var suffix = \"Heatmap/find\"\n    var url = this.base + suffix;\n    var query = {}\n    query.slide = slide\n    query.specimen = \"\"\n    query.study = \"\"\n    if(name) query.name = name;\n\n    return fetch(url + \"?\" + objToParamStr(query), {\n      credentials: \"include\",\n      mode: \"cors\"\n    }).then(this.errorHandler).then(x=>this.filterBroken(x, \"heatmap\"))\n  };\n  Store.prototype.default_getHeatmap = Store.prototype.getHeatmap;\n  Store.prototype.getHeatmap = function(slide, exec) {\n    var suffix = \"Heatmap/get\"\n    var url = this.base + suffix;\n    var query = {}\n    query.slide = slide\n    query.specimen = \"\"\n    query.study = \"\"\n    if(exec) query.name = exec;\n\n    return fetch(url + \"?\" + objToParamStr(query), {\n      credentials: \"include\",\n      mode: \"cors\"\n    }).then(this.errorHandler).then(x=>this.filterBroken(x, \"heatmap\"))\n  };\n\n  StatesHelper.prototype.default_getCurrentStatesURL = StatesHelper.prototype.getCurrentStatesURL;\n  getCurrentStatesURL = function(isImageCoordinate=false){\n    let states = StatesHelper.getCurrentStates(isImageCoordinate);\n    if(!states)return;\n    console.log(states);\n    states = StatesHelper.encodeStates(states);\n    return `${location.origin}${location.pathname}?slideId=${$D.params.slideId}&states=${$D.params.states}&mode=${$D.params.mode}`\n  };\n\n\n  CaMic.prototype.default_loadImg = CaMic.prototype.loadImg\n  CaMic.prototype.loadImg = function(func) {\n    var urlParams = new URLSearchParams(window.location.search);\n    var pathdb_id = urlParams.get('slideId');\n    this.slideId = pathdb_id; // default value\n    this.slideName = pathdb_id;\n    this.collectionId = \"\";\n    this.collection = \"\"; \n    this.study = \"\";\n    this.specimen = \"\";\n    this.subject_id = \"\";\n    this.image_id = \"\";\n    this.study_id = \"\";\n    \n    this.store.getSlide(pathdb_id).then(data => {\n      data = data[0];\n      console.log(data);\n      // set mpp\n      this.mpp = 1e9\n\n      if (data.field_mpp_y && data.field_mpp_y.length >= 1) {\n        this.mpp_y = data.field_mpp_y[0].value\n        this.mpp = this.mpp_y\n      }\n      if (data.field_mpp_x && data.field_mpp_x.length >= 1) {\n        this.mpp_x = data.field_mpp_x[0].value\n        this.mpp = this.mpp_x\n      }\n      if (data.referencepixelphysicalvaluey && data.referencepixelphysicalvaluey.length >=1){\n        this.mpp_y = data.referencepixelphysicalvaluey[0].value\n        this.mpp = this.mpp_y\n      }\n      if (data.referencepixelphysicalvaluex && data.referencepixelphysicalvaluex.length >=1){\n        this.mpp_x = data.referencepixelphysicalvaluex[0].value\n        this.mpp = this.mpp_x\n      }\n      // identifier fields\n      if(data.field_subject_id && data.field_subject_id.length >= 1){\n        this.subject_id = data.field_subject_id[0].value\n      }\n      if(data.clinicaltrialsubjectid && data.clinicaltrialsubjectid.length >= 1){\n        this.subject_id = data.clinicaltrialsubjectid[0].value\n      }\n      if(data.field_image_id && data.field_image_id.length >=1){\n        this.image_id = data.field_image_id[0].value\n      }\n      if(data.imageid && data.imageid.length >=1){\n        this.image_id = data.imageid[0].value\n      }\n      if(data.field_study_id && data.field_study_id.length >=1){\n        this.study_id = data.field_study_id[0].value\n      }\n      if(data.studyid && data.studyid.length >=1){\n        this.study_id = data.studyid[0].value\n      }\n      if(data.field_collection && data.field_collection.length >= 1){\n        this.collectionId = data.field_collection[0].target_id;\n      }\n      Store.prototype.pdb_hm_name = this.image_id\n\n      if (data.field_iip_path && data.field_iip_path.length >= 1) {\n        this.location = data.field_iip_path[0].value\n        // MAKE URL FOR IIP\n        this.url = \"../../img/IIP/raw/?DeepZoom=\" + this.location + \".dzi\"\n        this.viewer.open(this.url);\n      } else {\n        throw \"No image location --could be token\"\n      }\n      this.viewer.mpp = this.mpp;\n      this.viewer.mpp_x = this.mpp_x;\n      this.viewer.mpp_y = this.mpp_y;\n\n      //set scalebar\n      if (this.mpp && this.mpp != 1e9) this.createScalebar(this.mpp)\n      var imagingHelper = new OpenSeadragonImaging.ImagingHelper({\n        viewer: this.viewer\n      });\n      imagingHelper.setMaxZoom(1);\n      // create item to pass to the callback function, previously x[0] (slide data)\n      let x = {};\n      x['_id'] = this.slideId;\n      x.name = this.slideName;\n      this.store.getCollection(this.collectionId).then(cdata => {\n        console.log(cdata[0].name[0].value);\n        x.collection = cdata[0].name[0].value;\n        console.log(x.collection);\n      });\n      // identifier field\n      x.subject_id = this.subject_id;\n      x.image_id = this.image_id;\n      x.study_id = this.study_id;\n      x.collectionId = this.collectionId;\n      console.log(x.collection);\n      x.fullLabel = x.study_id + ' | ' + x.subject_id + ' | ' + x.image_id;\n      x.study = this.study;\n      x.specimen = this.specimen;\n      x.mpp = this.mpp;\n      x.mpp_x = this.mpp_x;\n      x.mpp_y = this.mpp_y;\n      x.location = this.location;\n      x.url = this.url;\n      if (func && typeof func === 'function') {\n        func.call(null, x);\n      }\n      Loading.text.textContent = `Loading Slide's Tiles...`;\n      // we may want another init.js or our own callback\n    }).catch(e => {\n      console.error(e)\n      Loading.text.textContent = \"ERROR - PathDB Image Error (Try A Refresh)\"\n      //if(func && typeof func === 'function') func.call(null,{hasError:true,message:e});\n    })\n\n  }\n}\n\n\nPathDbMods()\nconsole.warn(\"This Setup Is Intended For Pathdb\")\n"]}