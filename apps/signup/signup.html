<!DOCTYPE html>
<html>

  <head>
    <meta name="keywords" content="camicroscope, quip" />
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
    <title>CaMicroscope - User Signup</title>

    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">

    <link rel='stylesheet' type='text/css' media='all' href='../../css/normalize.css'/>
    <link rel='stylesheet' type='text/css' media='all' href='signup.css'/>
  </head>
  <script>
    var userSignupUrl = "../../data/Auth/post"
    function addUser(){
      var email = document.getElementById("mail").value
      var collections = document.getElementById("collections").value
      // var attr = document.querySelector('input[name="attr"]:checked').value
      var attrEle = document.getElementById("attr");
      var attr = attrEle.options[attrEle.selectedIndex].value;
      var attr_doc = []
      if (attr == "3"){
        attr_doc = ["write", "admin"]
      }
      if (attr == "2"){
        attr_doc = ["write"]
      }
      var doc = {name: email, attrs: attr_doc, accessCollection:collections}
      fetch(userSignupUrl, {
          method: 'POST',
          mode: 'cors', // no-cors, cors, *same-origin
          cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
          credentials: 'same-origin', // include, *same-origin, omit
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(doc)
      }).then(x=>{
        if (x.status>=400){
          throw "failed to sign up user"
        }
        x.json()
      }).then(x=>{
        window.alert("success")
        console.log(x)
      }).catch(e=>{
        // window.alert("error!")
        console.error(e)
    })
    }
    let curr = 'signup'
    let prev = 'login'    
    const toggleLogin = function(){
      let temp = prev
      prev = curr
      curr = temp
      document.querySelector('.' + prev + '-form').style.display = 'none'
      document.querySelector('.' + curr + '-form').style.display = 'block'

    }
  </script>

  <body>

    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark" style="position: sticky;">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item link">
            <a class="nav-link" href="../landing/landing.html">Home</a>
          </li>
          <li class="nav-item link">
            <a class="nav-link" href="../table.html">Slides</a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item active link" style="font-family: sans-serif;">
            <a class="nav-link" href="./signup.html">Signup</a>
          </li>
          <li class="nav-item link">
            <a class="nav-link" target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLScL91LxrpAZjU88GBZP9gmcdgdf8__uNUwhws2lzU6Lr4qNwA/viewform">Feedback</a>
          </li>
        </ul>
      </div>
    </nav>


    <div class="signup-form">
      <div
        style="text-align:center; background: #17a2b8; font-size: xx-large; color: white; padding: 4px; border-radius: 5px 5px 0px 0px;">
        caMicroscope
      </div>
      <!-- <hr style="width: 24.25em;  height: 0.01em; background-color: black; margin-top: 0em; margin-bottom: 0;"> -->

      <form>
        <h2 style="margin-top: -.5em;">User Signup</h2>
        <hr
          style="width: 24.25em; margin-left: -1.9em; height: 0.01em; background-color: rgb(172, 172, 172); margin-bottom: 2em;">
        <div class="form-group">
        </div>
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-envelope" style="margin-top: 0.5em;"></i></span>
            <input id="mail" type="email" class="form-control" name="email" placeholder="Email" required="required">
          </div>
        </div>
        <br>
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-th-list" style="margin-top: 0.5em;"></i></span>
            <input type="text" id="collections" class="form-control" placeholder="['list','of','collections']"
              required="required">
          </div>
        </div> <br>

        <!-- User Type selection -->
        <select id="attr" class="browser-default custom-select">
          <option selected value="1">Viewer</option>
          <option value="2">Editor</option>
          <option value="3">Admin (and Editor)</option>
        </select>

        <br> <br>
        <div class="form-group">
          <button type="submit" id="sub" class="btn btn-primary btn-block btn-lg sub-btn" onclick="addUser()">Sign
            Up</button>
        </div>
        <p class="small text-center">If you reach this page, it's likely that you tried to log into this instance but lack
          access.
          Email the administrator if you want to be added. If you are an admin, you should be able to use this form.</p>
      </form>
      <div class="text-center">
        <a class="login-link" onclick="toggleLogin()">Already have an account? <b>Login</b></a> 
      </div>
    </div>
    <div class="login-form" style="display: none;">
    <img src="https://avatars2.githubusercontent.com/u/12075069?s=400&v=4" alt="logo" class="comp-logo">
    <div class="login-form-container">
        <p class="login-type">User Login</p>
        <form action="" method="POST" style="background-color: transparent; border: none; box-shadow: none;">
            <input type="email" class="login-email" placeholder="Email">
            <input type="password" class="login-pass" placeholder="Password">
            <button type="submit" id="btn-submit"></button>
            <label for="btn-submit" class="btn-login">LOGIN</label>
            <a href="#" class="forget-pass">Forgot Password</a>
            <a href="#" class="new-user" onclick="toggleLogin()">New User? SIGNUP</a>
        </form>
    </div>
  </div>

    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
  </body>
</html>